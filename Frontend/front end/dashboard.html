<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Keycheeky — Dashboard</title>
    <style>
      :root {
        --primary: #22c55e;
        --muted: #475569;
        --surface: #fff;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Inter, system-ui, Segoe UI, Roboto, Arial;
        background: linear-gradient(
          135deg,
          rgba(34, 197, 94, 0.03),
          rgba(168, 85, 247, 0.03)
        );
        color: #0f172a;
        min-height: 100vh;
      }
      header {
        background: linear-gradient(135deg, var(--primary), #a855f7);
        padding: 12px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #fff;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .logo {
        display: flex;
        gap: 10px;
        align-items: center;
        text-decoration: none;
        color: white;
        font-weight: 700;
      }
      .logo img {
        height: 34px;
        width: 34px;
        border-radius: 6px;
        background: #fff;
        padding: 4px;
      }
      /* Centering */
      main {
        min-height: calc(100vh - 140px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }
      .card {
        background: var(--surface);
        padding: 18px;
        border-radius: 12px;
        border: 1px solid #e6eef7;
        box-shadow: 0 6px 14px rgba(12, 12, 12, 0.04);
        width: 100%;
        max-width: 980px;
      }
      .toolbar {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 12px;
      }
      .btn {
        padding: 10px 14px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        font-weight: 700;
      }
      .btn-primary {
        background: linear-gradient(135deg, var(--primary), #16a34a);
        color: white;
      }
      .btn-secondary {
        background: transparent;
        border: 2px solid var(--primary);
        color: var(--primary);
      }
      .list-item {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        border-bottom: 1px solid #eef6fb;
      }
      .small {
        font-size: 13px;
        color: var(--muted);
      }
      footer {
        text-align: center;
        margin-top: 24px;
        color: #fff;
        background: linear-gradient(135deg, var(--primary), #a855f7);
        padding: 14px;
      }
      @media (max-width: 720px) {
        main {
          padding: 18px;
        }
        .card {
          padding: 16px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <a class="logo" href="index.html"
        ><img
          src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/5623b684-54b5-4520-873d-526cb122aace"
          alt="KeyCheeky"
        />Keycheeky</a
      >
      <nav>
        <a
          href="#"
          id="whoami"
          style="font-weight: 600; color: #fff; margin-right: 12px"
        ></a>
        <a
          href="#"
          onclick="logout()"
          style="color: #fff; text-decoration: none"
          >Logout</a
        >
      </nav>
    </header>

    <main>
      <div class="card">
        <h2 style="color: var(--primary); margin-bottom: 8px">Dashboard</h2>
        <div class="toolbar">
          <button class="btn btn-primary" onclick="showPasswords()">
            See list of passwords
          </button>
          <button class="btn btn-secondary" onclick="showAdd()">
            Add password
          </button>
        </div>

        <div id="content-area">
          <p class="small">Choose an action above to manage your entries.</p>
        </div>
      </div>
    </main>

    <footer>&copy; 2025 Keycheeky — Demo</footer>

    <script>
      function getUsers() {
        return JSON.parse(localStorage.getItem("kc_users") || "[]");
      }
      function getPasswords() {
        return JSON.parse(localStorage.getItem("kc_passwords") || "{}");
      }
      function savePasswords(obj) {
        localStorage.setItem("kc_passwords", JSON.stringify(obj));
      }
      function currentUser() {
        return localStorage.getItem("kc_current_user") || null;
      }

      (function checkAuth() {
        const cur = currentUser();
        if (!cur) {
          alert("You are not logged in. Redirecting to Login.");
          window.location.href = "login.html";
          return;
        }
        document.getElementById("whoami").textContent = cur;
      })();

      function logout() {
        localStorage.removeItem("kc_current_user");
        window.location.href = "index.html";
      }

      function showPasswords() {
        const cur = currentUser();
        if (!cur) {
          logout();
          return;
        }
        const pw = getPasswords()[cur] || [];
        const container = document.getElementById("content-area");
        container.innerHTML = "";
        if (pw.length === 0) {
          container.innerHTML =
            '<p class="small">No saved entries yet. Use Add password to create one.</p>';
          return;
        }

        const list = document.createElement("div");
        pw.forEach((e, i) => {
          const item = document.createElement("div");
          item.className = "list-item";
          const left = document.createElement("div");
          left.innerHTML =
            "<strong>" +
            escapeHtml(e.site) +
            '</strong><div class="small">' +
            escapeHtml(e.username) +
            "</div>";
          const right = document.createElement("div");
          const view = document.createElement("button");
          view.className = "btn";
          view.textContent = "View";
          view.onclick = () => viewPassword(i);
          const del = document.createElement("button");
          del.className = "btn";
          del.style.background = "#ef4444";
          del.style.color = "white";
          del.textContent = "Delete";
          del.onclick = () => deletePassword(i);
          right.appendChild(view);
          right.appendChild(del);
          right.style.display = "flex";
          right.style.gap = "8px";
          item.appendChild(left);
          item.appendChild(right);
          list.appendChild(item);
        });
        container.appendChild(list);
      }

      function showAdd() {
        const cur = currentUser();
        if (!cur) {
          logout();
          return;
        }
        const container = document.getElementById("content-area");
        container.innerHTML = `
    <div style="margin-top:6px">
      <div style="margin-bottom:10px"><label style="display:block;font-weight:700">Site / App</label><input id="site" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef7"></div>
      <div style="margin-bottom:10px"><label style="display:block;font-weight:700">Username / Email</label><input id="uname" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef7"></div>
      <div style="margin-bottom:10px"><label style="display:block;font-weight:700">Password</label><input id="pwd" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef7"></div>
      <div style="display:flex;gap:8px"><button class="btn btn-primary" onclick="addEntry()">Save</button><button class="btn" onclick="showPasswords()">Cancel</button></div>
      <p id="addmsg" class="small" style="margin-top:10px;color:#c0392b"></p>
    </div>`;
      }

      function addEntry() {
        const site = (document.getElementById("site").value || "").trim();
        const username = (document.getElementById("uname").value || "").trim();
        const pwd = (document.getElementById("pwd").value || "").trim();
        const msg = document.getElementById("addmsg");
        if (!site || !username || !pwd) {
          if (msg) msg.textContent = "Please fill all fields.";
          return;
        }
        const cur = currentUser();
        const all = getPasswords();
        all[cur] = all[cur] || [];
        all[cur].push({
          site,
          username,
          password: pwd,
          updated: new Date().toISOString().split("T")[0],
        });
        savePasswords(all);
        if (msg) {
          msg.style.color = "green";
          msg.textContent = "Saved.";
        }
        setTimeout(() => showPasswords(), 500);
      }

      function viewPassword(index) {
        const cur = currentUser();
        const all = getPasswords();
        const entry = (all[cur] || [])[index];
        if (!entry) return;
        alert(
          "Site: " +
            entry.site +
            "\nUsername: " +
            entry.username +
            "\nPassword (demo): " +
            entry.password
        );
      }

      function deletePassword(index) {
        if (!confirm("Delete this entry?")) return;
        const cur = currentUser();
        const all = getPasswords();
        (all[cur] || []).splice(index, 1);
        savePasswords(all);
        showPasswords();
      }

      function escapeHtml(text) {
        if (!text) return "";
        return text.replace(
          /[&<>"']/g,
          (m) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[m])
        );
      }
    </script>
  </body>
</html>
